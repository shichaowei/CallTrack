<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>Concepts</title>
      <link rel="stylesheet" href="ystyle.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.65.1">
      <link rel="home" href="index.html" title="yFiles for Java Developer's Guide">
      <link rel="up" href="layout.html" title="Chapter&nbsp;5.&nbsp;Automatic Graph Layout">
      <link rel="previous" href="layout_architecture.html" title="Layout Architecture">
      <link rel="next" href="layout_advanced_features.html" title="Advanced Layout Concepts">
      <link rel="stylesheet" href="jsdt/toc.css" type="text/css"><script type="text/javascript" src="jsdt/jquery.min.js"></script><script type="text/javascript" src="jsdt/toc.js"></script><link type="text/css" rel="stylesheet" href="jssh/SyntaxHighlighter.css"><script type="text/javascript" src="jssh/shCore.js"></script><script type="text/javascript" src="jssh/shBrushJava.js"></script><script type="text/javascript" src="jssh/shBrushXml.js"></script><script type="text/javascript">
  function sh() {

    dp.SyntaxHighlighter.HighlightAll('programlisting', false, false, false, null, false);
  }
  </script></head>
   <body onload="sh()" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">Concepts</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="layout_architecture.html">Prev</a>&nbsp;
               </td>
               <th width="60%" align="center">Chapter&nbsp;5.&nbsp;Automatic Graph Layout</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="layout_advanced_features.html">Next</a></td>
            </tr>
         </table>
         <div class="navline"></div>
         <div style="display:none"><img src="figures/navbg.jpg" alt=""><img src="figures/navline.jpg" alt=""></div>
      </div>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="layout_concepts"></a>Concepts
                  </h2>
               </div>
            </div>
            <div></div>
         </div>
         <p>
            The task of a layout algorithm is a major undertaking that involves arbitrarily 
            complex logic. 
            However, there can be identified a number of well-defined (sub-)tasks that even 
            completely different algorithms do in a similar manner. 
            
            Factoring out such tasks so that they can be reused in varying contexts, 
            greatly reduces the complexity of any layout algorithm. 
            
         </p>
         <p>
            The yFiles library allows to formulate complex layout processes by plugging 
            together so-called "layout stages" that, among other things, can be used to 
            handle such well-defined (sub-)tasks. 
            
         </p>
         <div class="section" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="stages"></a>The Layout Stages Concept
                     </h3>
                  </div>
               </div>
               <div></div>
            </div><a class="indexterm" name="d0e3112"></a><p>
               A layout stage serves as a kind of container that encapsulates arbitrary layout 
               functionality, and provides a general means to string together multiple stages 
               into a compound layout process. 
               
               
               
               Interface <a href="../api/y/layout/LayoutStage.html" title="Link to API documentation" target="_top">LayoutStage<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> defines the 
               basis for a layout stage. 
               It is a specialization of interface 
               <a href="../api/y/layout/Layouter.html" title="Link to API documentation" target="_top">Layouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, and thus can be used as a 
               stand-alone layout provider as well as a part of a larger layout process. 
               
            </p>
            <div class="figure"><a name="fig_layoutstage"></a><p class="title"><b>Figure&nbsp;5.6.&nbsp;LayoutStage</b></p>
               <div class="informaltable">
                  <center>
                     <table border="0">
                        <colgroup>
                           <col width="100%">
                        </colgroup>
                        <tbody>
                           <tr>
                              <td>
                                 <div class="mediaobject" align="center"><img src="figures/layoutstage.jpg" align="middle" alt="LayoutStage."></div>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </center>
               </div>
            </div>
            <p>
               The methods of interface LayoutStage are used to establish a relationship to 
               another Layouter implementation, the so-called "core layouter." 
               The core layouter's invocation is entirely bracketed by the layout stage's 
               logic. 
               
            </p>
            <p>
               When used in the context of a larger layout process, the layout stage can 
               easily be used to simplify the core layouter's task. 
               It performs preprocessing steps on the input graph before the core layouter's 
               invocation, and postprocessing steps thereafter. 
               
            </p>
            <p>
               <a href="layout_concepts.html#tab_layoutstages" title="Table&nbsp;5.1.&nbsp;Predefined layout stages">Table&nbsp;5.1, &#8220;Predefined layout stages&#8221;</a> lists some of the predefined LayoutStage 
               implementations, most of them being part of the default compound layout process 
               <a href="layout_concepts.html#default_compound_layout" title="Default Compound Layout Process">as described below</a>. 
               
               Further layout stages are described in <a href="layout_stages.html" title="Layout Stages">the section called &#8220;Layout Stages&#8221;</a>. 
               
            </p>
            <div class="table"><a name="tab_layoutstages"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;Predefined layout stages</b></p>
               <table summary="Predefined layout stages" width="100%" border="1">
                  <colgroup>
                     <col width="20%" align="left">
                     <col width="80%" align="left">
                  </colgroup>
                  <thead valign="top">
                     <tr>
                        <th align="left">Classname</th>
                        <th align="left">Description</th>
                     </tr>
                  </thead>
                  <tbody valign="top">
                     <tr>
                        <td align="left"><a href="../api/y/layout/BufferedLayouter.html" title="Link to API documentation" target="_top">BufferedLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                        <td align="left">
                             Duplicates the graph to be processed, so that the layout cannot destroy the 
                             original data. 
                             See also the 
                             <a href="layout_concepts.html#buffering" title="Using Buffered Layout">description of buffered layout calculation</a> 
                             below. 
                             
                        </td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/SelfLoopLayouter.html" title="Link to API documentation" target="_top">SelfLoopLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                        <td align="left">
                             Calculates orthogonal edge paths for a graph's self-loops (reflexive edges). 
                             
                        </td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/ParallelEdgeLayouter.html" title="Link to API documentation" target="_top">ParallelEdgeLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                        <td align="left">
                             Calculates edge paths for all edges with identical source node and target 
                             node. 
                             (Self-loops are not processed.) 
                             
                        </td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/OrientationLayouter.html" title="Link to API documentation" target="_top">OrientationLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                        <td align="left">
                             Changes the orientation of a computed layout. 
                           
                             
                        </td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/SubgraphLayouter.html" title="Link to API documentation" target="_top">SubgraphLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                        <td align="left">
                             Reduces the original graph to the subgraph that is induced by selected nodes. 
                             
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
            <p>
               <a href="layout_concepts.html#fig_layoutstages" title="Figure&nbsp;5.7.&nbsp;Layout stages complex">Figure&nbsp;5.7, &#8220;Layout stages complex&#8221;</a> shows the class hierarchy for the layout 
               stages. 
               
               
            </p>
            <div class="figure"><a name="fig_layoutstages"></a><p class="title"><b>Figure&nbsp;5.7.&nbsp;Layout stages complex</b></p>
               <div class="informaltable">
                  <center>
                     <table border="0">
                        <colgroup>
                           <col width="100%">
                        </colgroup>
                        <tbody>
                           <tr>
                              <td>
                                 <div class="mediaobject" align="center"><img src="figures/layoutstage_layouters_max_2.jpg" align="middle" alt="Layout stages complex."></div>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </center>
               </div>
            </div>
         </div>
         <div class="section" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="default_compound_layout"></a>Default Compound Layout Process
                     </h3>
                  </div>
               </div>
               <div></div>
            </div><a class="indexterm" name="d0e3218"></a><a class="indexterm" name="d0e3223"></a><p>
               Except for class BufferedLayouter, all layout stages from 
               <a href="layout_concepts.html#tab_layoutstages" title="Table&nbsp;5.1.&nbsp;Predefined layout stages">Table&nbsp;5.1, &#8220;Predefined layout stages&#8221;</a> are part of the compound layout process 
               defined by CanonicMultiStageLayouter. 
               
               The following methods of class CanonicMultiStageLayouter can be used for configuring
               the layout process:
               
            </p>
            <div class="techn_templ">
               <center>
                  <table width="100%" border="1">
                     <colgroup>
                        <col width="16%" align="left">
                        <col width="84%" align="left">
                     </colgroup>
                     <tbody valign="top">
                        <tr class="techn_api">
                           <td colspan="2" align="left"><pre class="programlisting ignore"><a href="../api/y/layout/CanonicMultiStageLayouter.html#appendStage(y.layout.LayoutStage)" title="Link to API documentation" target="_top">void appendStage(LayoutStage stage)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#prependStage(y.layout.LayoutStage)" title="Link to API documentation" target="_top">void prependStage(LayoutStage stage)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#removeStage(y.layout.LayoutStage)" title="Link to API documentation" target="_top">void removeStage(LayoutStage stage)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
</pre></td>
                        </tr>
                        <tr class="spacing">
                           <td align="left">Description</td>
                           <td align="left">Methods to add and remove individual layout stages.</td>
                        </tr>
                        <tr class="techn_api">
                           <td colspan="2" align="left"><pre class="programlisting ignore"><a href="../api/y/layout/CanonicMultiStageLayouter.html#enableOnlyCore()" title="Link to API documentation" target="_top">void enableOnlyCore()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#isComponentLayouterEnabled()" title="Link to API documentation" target="_top">boolean isComponentLayouterEnabled()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#isSelfLoopLayouterEnabled()" title="Link to API documentation" target="_top">boolean isSelfLoopLayouterEnabled()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#setComponentLayouterEnabled(boolean)" title="Link to API documentation" target="_top">void setComponentLayouterEnabled(boolean enabled)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#setSelfLoopLayouterEnabled(boolean)" title="Link to API documentation" target="_top">void setSelfLoopLayouterEnabled(boolean enabled)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
</pre></td>
                        </tr>
                        <tr class="spacing">
                           <td align="left">Description</td>
                           <td align="left">
                              Methods for enabling and disabling the predefined layout stages, and also for controlling
                              their enabled state.
                              (Excerpt.)
                              
                           </td>
                        </tr>
                        <tr class="techn_api">
                           <td colspan="2" align="left"><pre class="programlisting ignore"><a href="../api/y/layout/CanonicMultiStageLayouter.html#getComponentLayouter()" title="Link to API documentation" target="_top">LayoutStage getComponentLayouter()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#getSelfLoopLayouter()" title="Link to API documentation" target="_top">LayoutStage getSelfLoopLayouter()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#setComponentLayouter(y.layout.LayoutStage)" title="Link to API documentation" target="_top">void setComponentLayouter(LayoutStage layouter)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/layout/CanonicMultiStageLayouter.html#setSelfLoopLayouter(y.layout.LayoutStage)" title="Link to API documentation" target="_top">void setSelfLoopLayouter(LayoutStage layouter)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
</pre></td>
                        </tr>
                        <tr class="spacing">
                           <td align="left">Description</td>
                           <td align="left">
                              Getter and setter methods for predefined layout stages.
                              (Excerpt.)
                              
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </center>
            </div>
         </div>
         <div class="section" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="buffering"></a>Using Buffered Layout
                     </h3>
                  </div>
               </div>
               <div></div>
            </div><a class="indexterm" name="d0e3302"></a><p>
               With the yFiles layout algorithms it is possible to have a graph layout 
               calculated using two different approaches, namely "unbuffered" layout or 
               "buffered" layout. 
               
               Unbuffered layout means to directly invoke a layout algorithm's 
               <a href="../api/y/layout/Layouter.html#doLayout(y.layout.LayoutGraph)" title="Link to API documentation" target="_top">doLayout<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> 
               method. 
               Choosing this approach, the layout calculation is performed on the given graph, 
               and is also immediately assigned. 
               
               Buffered layout, in contrast, utilizes class 
               <a href="../api/y/layout/BufferedLayouter.html" title="Link to API documentation" target="_top">BufferedLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, which creates a copy 
               of the original graph that is then used for layout calculation. 
               
            </p>
            <p>
               Unbuffered layout has some severe drawbacks that should be observed: 
               
               
            </p>
            <div class="itemizedlist">
               <ul type="disc">
                  <li>
                     A layout algorithm might perform badly in terms of memory consumption and 
                     execution time, due to the implementation of the graph structure. 
                     Crucial graph methods might not be optimized for layout tasks. 
                     
                     For instance, invoking a layout algorithm directly on an instance of 
                     <a href="../api/y/view/Graph2D.html" title="Link to API documentation" target="_top">Graph2D<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> is almost never a good idea, 
                     since its nodes and edges are rather "heavy." 
                     
                  </li>
                  <li>
                     Some layout algorithms need to temporarily add/remove nodes or edges to/from 
                     the given graph. 
                     Any registered graph listeners will be notified about such structural changes, 
                     which subsequently might result in unnecessary or even harmful action on a 
                     listener's behalf. 
                     
                  </li>
                  <li>
                     Even though it is guaranteed that a layout algorithm will not change a graph's 
                     node set and edge set, it is not unusual that the ordering of nodes and/or 
                     edges is modified. 
                     
                     Consequently, it is not safe to rely on the index() feature of nodes or edges. 
                     
                  </li>
                  <li>
                     In rare cases it might happen that a layout algorithm will crash during a 
                     calculation (due to a bug, for example). 
                     It will then return immediately and generate an exception. 
                     The input graph will be left in an intermediate, often broken state and no 
                     recovery will be possible for it.
                     
                  </li>
                  <li>
                     Directly invoking a layout algorithm's doLayout() method will not return the 
                     calculated coordinates, but instead assign them right away to the given graph. 
                     
                     Consequently, any other way of coordinate assignment, e.g., in an animated 
                     fashion using coordinate interpolation, is defeated. 
                     
                  </li>
               </ul>
            </div>
            <p>
               
            </p>
            <p>
               With these drawbacks in mind, it is almost always a good idea to choose 
               buffered layout instead. 
               It facilitates many sophisticated features, like, e.g., layout morphing, and at 
               the same time increases an application's robustness. 
               
            </p>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a name="cls_BufferedLayouter"></a>Class BufferedLayouter
                        </h4>
                     </div>
                  </div>
                  <div></div>
               </div><a class="indexterm" name="d0e3335"></a><p>
                  The main purpose of class 
                  <a href="../api/y/layout/BufferedLayouter.html" title="Link to API documentation" target="_top">BufferedLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> is to create a copy of 
                  the input graph before calling its core layouter. 
                  
                  The graph structure that is used for the copied graph is optimized for layout 
                  calculation. 
                  
               </p>
               <p>
                  The core layouter subsequently executes on the copy and calculates a new 
                  layout, which is then transferred to the original graph. 
                  There are several beneficial aspects of this functionality: 
                  
               </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        The structure of the input graph is guaranteed to not change at all. 
                        
                        Usually, layout providers (i.e., Layouter implementations) make no guarantees 
                        on leaving the sequence of nodes or edges unchanged, which may result in 
                        unexpected side effects. 
                        One such side effect is, for example, that a layouter may assign completely 
                        different layouts to a graph when being invoked twice on the same graph. 
                        
                        The reason for such behavior is that a layout provider's output in general 
                        depends on the sequence of elements in the graph, but this sequence has changed 
                        with the first layout invocation. 
                        
                     </li>
                     <li>
                        Instead of immediately writing back the calculated layout to the given input 
                        graph, class BufferedLayouter provides the possibility to return the result as 
                        a <a href="../api/y/layout/GraphLayout.html" title="Link to API documentation" target="_top">GraphLayout<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> object, leaving the 
                        original graph's layout unmodified. 
                        
                        The GraphLayout object then allows to defer coordinate assignment to a later 
                        point in time, for example, using class LayoutTool's 
                        <a href="../api/y/layout/LayoutTool.html#applyGraphLayout(y.layout.LayoutGraph, y.layout.GraphLayout)" title="Link to API documentation" target="_top">applyGraphLayout<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> 
                        method. 
                        By means of class <a href="../api/y/view/LayoutMorpher.html" title="Link to API documentation" target="_top">LayoutMorpher<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, it can 
                        also be used to nicely "morph" from one layout to another in an animated 
                        fashion. 
                        (See <a href="advanced_stuff.html#morphing" title="Layout Morphing">the section called &#8220;Layout Morphing&#8221;</a>.) 
                        
                        
                     </li>
                     <li>
                        Calculating a layout on a copy instead of the original graph proves to be more 
                        robust. 
                        Even if there should occur an unrecoverable error in the layout process, class 
                        BufferedLayouter guarantees that the structure of the input graph remains 
                        consistent. 
                        
                        
                        
                     </li>
                  </ul>
               </div>
               <p>
                  
               </p>
               <p>
                  Wrapping a layout algorithm with a BufferedLayouter layout stage is as easy as 
                  shown in <a href="layout_concepts.html#ex_buffering" title="Example&nbsp;5.3.&nbsp;Using buffered layout">Example&nbsp;5.3, &#8220;Using buffered layout&#8221;</a>. 
                  
               </p>
               <div class="example"><a name="ex_buffering"></a><p class="title"><b>Example&nbsp;5.3.&nbsp;Using buffered layout</b></p><pre class="programlisting java">
// 'graph' is of type y.layout.LayoutGraph. 

// Run organic layout by implicitly wrapping its invocation using the services 
// of class BufferedLayouter. 
new BufferedLayouter(new SmartOrganicLayouter()).doLayout(graph);
</pre></div>
               <p>
                  Alternatively, class BufferedLayouter allows to get the calculated graph layout 
                  as a separate object. 
                  This is demonstrated in <a href="layout_concepts.html#ex_buffering_2" title="Example&nbsp;5.4.&nbsp;Buffered layout with deferred coordinate assignment">Example&nbsp;5.4, &#8220;Buffered layout with deferred coordinate assignment&#8221;</a>. 
                  
               </p>
               <div class="example"><a name="ex_buffering_2"></a><p class="title"><b>Example&nbsp;5.4.&nbsp;Buffered layout with deferred coordinate assignment</b></p><pre class="programlisting java">
// 'graph' is of type y.layout.LayoutGraph. 

// Run organic layout by implicitly wrapping its invocation using the services 
// of class BufferedLayouter. 
// The result of the layout is returned separately as a GraphLayout object, 
// i.e., the original graph's layout information is not changed. 
GraphLayout gl = 
    new BufferedLayouter(new SmartOrganicLayouter()).calcLayout(graph);
</pre></div>
            </div>
         </div>
         <div class="section" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="supplemental_information"></a>Providing Supplemental Layout Data
                     </h3>
                  </div>
               </div>
               <div></div>
            </div><a class="indexterm" name="d0e3384"></a><a class="indexterm" name="d0e3389"></a><p>
               The yFiles layout algorithms support advanced functionality that can take into 
               account even individual information for single graph elements. 
               
               However, individual setup like, e.g., attaching a preferred edge length to each 
               edge, is beyond the means a graph structure provides. 
               Instead, the data accessor concept as described in 
               <a href="data_accessors.html" title="Binding Data to Graph Elements">the section called &#8220;Binding Data to Graph Elements&#8221;</a> is utilized to provide the individual setup as 
               supplemental information to a layout algorithm. 
               
            </p>
            <p>
               The supplemental data for the graph elements is bound to the graph using a 
               so-called "data provider key." 
               
               During layout calculation, the algorithm then retrieves the data provider that 
               contains the data from the graph by using the same key. 
               
            </p>
            <p>
               Depending on the data provider key, the algorithm expects the returned data
               provider to hold values of specific type for either nodes or edges of the
               graph.
               
               <a href="layout_concepts.html#ex_supplemental" title="Example&nbsp;5.5.&nbsp;Binding supplemental data">Example&nbsp;5.5, &#8220;Binding supplemental data&#8221;</a> shows the use of an implicit data provider
               that returns an integral value for each edge indicating the edge's preferred
               length to the organic layout algorithm.
               
            </p>
            <div class="example"><a name="ex_supplemental"></a><p class="title"><b>Example&nbsp;5.5.&nbsp;Binding supplemental data</b></p><pre class="programlisting java">
// 'graph' is of type y.layout.LayoutGraph. 

// Create an implicit data provider and register it with the graph using a 
// so-called data provider look-up key. 
// The key is then used by the layout algorithm to retrieve the supplemental 
// data. 
graph.addDataProvider(SmartOrganicLayouter.PREFERRED_EDGE_LENGTH_DATA,
                      new DataProviderAdapter() {
  public int getInt(Object o) {
    return (int)(200 * getLength((Edge)o));
  }
});

// Invoke organic layout on the graph. 
SmartOrganicLayouter sol = new SmartOrganicLayouter();
sol.doLayout(graph);

// Remove the data provider from the graph. 
graph.removeDataProvider(SmartOrganicLayouter.PREFERRED_EDGE_LENGTH_DATA);
</pre></div>
         </div>
         <div class="section" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="aborthandler"></a>Abort Mechanism for Layout Calculations
                     </h3>
                  </div>
               </div>
               <div></div>
            </div><a class="indexterm" name="d0e3412"></a><p>
               Class <a href="../api/y/algo/AbortHandler.html" title="Link to API documentation" target="_top">AbortHandler<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a> provides an abort mechanism 
               for layout calculations. 
               This mechanism can be used to trigger early termination as well as instant termination 
               of a layout calculation.
               
            </p>
            <p>
               The abort handler for a graph is specified through a data provider that is bound 
               to the graph. 
               The data provider is expected to be registered with the graph using key 
               <a href="../api/y/algo/AbortHandler.html#ABORT_HANDLER_DPKEY" title="Link to API documentation" target="_top">ABORT_HANDLER_DPKEY<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>. 
               
               Once an abort handler is attached to a graph, any layout algorithm with support 
               for the abort mechanism working on this graph can be stopped or canceled using the 
               abort handler's methods.
               
            </p>
            <div class="techn_templ">
               <center>
                  <table width="100%" border="1">
                     <colgroup>
                        <col width="16%" align="left">
                        <col width="84%" align="left">
                     </colgroup>
                     <tbody valign="top">
                        <tr class="techn_api">
                           <td colspan="2" align="left"><pre class="programlisting ignore"><a href="../api/y/algo/AbortHandler.html#createForGraph(y.base.Graph)" title="Link to API documentation" target="_top">AbortHandler createForGraph(Graph graph)<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
</pre></td>
                        </tr>
                        <tr class="spacing">
                           <td align="left">Description</td>
                           <td align="left">
                              Returns a graph's attached abort handler or creates a new one and attaches it.
                              
                           </td>
                        </tr>
                        <tr class="techn_api">
                           <td colspan="2" align="left"><pre class="programlisting ignore"><a href="../api/y/algo/AbortHandler.html#stop()" title="Link to API documentation" target="_top">void stop()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
<a href="../api/y/algo/AbortHandler.html#cancel()" title="Link to API documentation" target="_top">void cancel()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
</pre></td>
                        </tr>
                        <tr class="spacing">
                           <td align="left">Description</td>
                           <td align="left">
                              Methods to trigger termination of layout calculations.
                              
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </center>
            </div>
            <p>
               Stopping the layout calculation results in early, but not immediate, termination 
               where the layout algorithm still delivers a consistent result.
               
            </p>
            <p>
               Canceling, in contrast, will end layout calculation instantly, throwing an <tt class="code">AlgorithmAbortedException</tt> 
               and all work done so far by the algorithm will be discarded. 
               This may lead to an inconsistent state of the graph. 
               It is thus recommended to only cancel layout algorithms that work on a copy of the 
               graph to avoid corrupting the original graph.
               
            </p>
            <p>
               Furthermore, when layout calculation is ended instantly, the state of the Layouter 
               instance may become corrupted. 
               Hence, a new instance has to be created after each cancelation.
               
            </p>
            <p>
               If a graph that has an AbortHandler attached is processed by multiple layout algorithms 
               (or multiple times by one layout algorithm), then the attached handler has to be 
               reset between algorithm runs: 
               
            </p>
            <div class="techn_templ">
               <center>
                  <table width="100%" border="1">
                     <colgroup>
                        <col width="16%" align="left">
                        <col width="84%" align="left">
                     </colgroup>
                     <tbody valign="top">
                        <tr class="techn_api">
                           <td colspan="2" align="left"><pre class="programlisting ignore"><a href="../api/y/algo/AbortHandler.html#reset()" title="Link to API documentation" target="_top">void reset()<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>
</pre></td>
                        </tr>
                        <tr class="spacing">
                           <td align="left">Description</td>
                           <td align="left">
                              Resets the abort handler's state so that any requests for early termination are 
                              discarded.
                              
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </center>
            </div>
            <p>
               Otherwise, previous requests for early termination may lead to an undesired early 
               termination of a subsequent algorithm run.
               
            </p>
            <p>
               The following code skeleton outlines the conceptual sequence of AbortHandler calls 
               around a layout calculation:
               
            </p>
            <div class="example"><a name="ex_aborthandler"></a><p class="title"><b>Example&nbsp;5.6.&nbsp;Using an abort handler in conjunction with a layout calculation</b></p><pre class="programlisting java">
// 'graph' is of type y.base.Graph.

// First retrieve the abort handler that is attached to the graph.
AbortHandler handler = AbortHandler.createForGraph(graph);

// Reset the abort handler to avoid early termination due to previous stop or 
// cancel requests.
handler.reset();

// Start layout calculation here.
// ...
  
// Now the layout algorithm can be stopped...
handler.stop();

// ... or canceled, if desired.
handler.cancel();
</pre></div>
            <p>
               The following layout algorithms and routing algorithms of the yFiles library have 
               built-in support for the abort mechanism:
               
            </p>
            <div class="table"><a name="tab_aborthandler"></a><p class="title"><b>Table&nbsp;5.2.&nbsp;Support for abort mechanism in yFiles algorithms</b></p>
               <table summary="Support for abort mechanism in yFiles algorithms" width="100%" border="1">
                  <colgroup>
                     <col width="20%" align="left">
                     <col width="80%" align="left">
                  </colgroup>
                  <thead valign="top">
                     <tr>
                        <th align="left">&nbsp;</th>
                        <th align="left">Classname</th>
                     </tr>
                  </thead>
                  <tbody valign="top">
                     <tr>
                        <td rowspan="4" align="left">Layout algorithms</td>
                        <td align="left"><a href="../api/y/layout/hierarchic/IncrementalHierarchicLayouter.html" title="Link to API documentation" target="_top">IncrementalHierarchicLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/circular/CircularLayouter.html" title="Link to API documentation" target="_top">CircularLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/organic/SmartOrganicLayouter.html" title="Link to API documentation" target="_top">SmartOrganicLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/orthogonal/OrthogonalLayouter.html" title="Link to API documentation" target="_top">OrthogonalLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, 
                             <a href="../api/y/layout/orthogonal/OrthogonalGroupLayouter.html" title="Link to API documentation" target="_top">OrthogonalGroupLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, 
                             <a href="../api/y/layout/orthogonal/DirectedOrthogonalLayouter.html" title="Link to API documentation" target="_top">DirectedOrthogonalLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, 
                             and <a href="../api/y/layout/orthogonal/CompactOrthogonalLayouter.html" title="Link to API documentation" target="_top">CompactOrthogonalLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                     <tr>
                        <td rowspan="2" align="left">Layout stages</td>
                        <td align="left"><a href="../api/y/layout/ComponentLayouter.html" title="Link to API documentation" target="_top">ComponentLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                     <tr>
                        <td align="left"><a href="../api/y/layout/ParallelEdgeLayouter.html" title="Link to API documentation" target="_top">ParallelEdgeLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                     <tr>
                        <td align="left">Routing algorithms</td>
                        <td align="left"><a href="../api/y/layout/router/polyline/EdgeRouter.html" title="Link to API documentation" target="_top">EdgeRouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                     </tr>
                  </tbody>
               </table>
            </div>
            <p>
               Tutorial demo application <a href="../../src/demo/layout/Graph2DLayoutExecutorDemo.java" title="Link to demo code" target="_top">Graph2DLayoutExecutorDemo.java</a> 
               shows how to create and use an abort handler when layout calculation is performed 
               by <a href="viewer_layout.html#cls_Graph2DLayoutExecutor" title="Class Graph2DLayoutExecutor">class Graph2DLayoutExecutor</a>.
               
            </p>
         </div>
         <div class="section" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="multithreading"></a>Multi-threading Support
                     </h3>
                  </div>
               </div>
               <div></div>
            </div><a class="indexterm" name="d0e3548"></a><p>
               The multi-threading support that is used by the algorithms in the yFiles library 
               can reduce the runtime of a layout calculation. 
               The support is based on the underlying threading capabilities of the Java Runtime 
               Environment (JRE) and exploits the provided resources of multi-core processor architectures.
               
            </p>
            <p>
               Multi-threaded layout calculation is enabled per algorithm by means of a simple 
               boolean setter method. 
               It can readily be used in any algorithm that provides support for it and doesn't 
               need any special setup.
               
            </p>
            <p>
               The key role in this multi-threading support has abstract class <a href="../api/y/util/TaskExecutorFactory.html" title="Link to API documentation" target="_top">TaskExecutorFactory<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>. 
               Implementations of this class are responsible for creating so-called task executors 
               that handle and run the single tasks that a layout calculation needs to be split 
               into to take full advantage of multiple threads of execution.
               
            </p>
            <p>
               The default implementation of this factory class doesn't create task executors itself, 
               but instead dynamically delegates this duty to another, actual factory, which it 
               finds by a multi-step search procedure. 
               
               The first step in this search queries the 
               <a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/spi/ServiceRegistry.html" target="_blank">Java service registry</a> 
               to find an implementation of the TaskExecutorFactory class. 
               By default, this yields class <a href="../api/y/util/MultiThreadedTaskExecutorFactory.html" title="Link to API documentation" target="_top">MultiThreadedTaskExecutorFactory<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a>, 
               which is listed with its fully-qualified name: 
               
               
            </p><pre class="programlisting java">
y.util.MultiThreadedTaskExecutorFactory
</pre><p>
               
               in the service declaration file <tt class="code">META-INF/services/y.util.TaskExecutorFactory</tt> 
               in the <tt class="code">META-INF</tt> directory of the yFiles for Java library Jar file.
               
            </p>
            <p>
               As described in the online Java Tutorials, this setup enables 
               <a href="http://docs.oracle.com/javase/tutorial/ext/basics/spi.html" target="_blank">Creating Extensible Applications</a>, 
               where customized behavior can be achieved without altering an application's source 
               code. 
               
               Simply by adding a new Jar file to an application's class path that contains 
               
            </p>
            <div class="itemizedlist">
               <ul type="disc">
                  <li>the compiled implementation of the TaskExecutorFactory class</li>
                  <li>
                     and a service declaration file <tt class="code">META-INF/services/y.util.TaskExecutorFactory</tt> 
                     in its <tt class="code">META-INF</tt> directory holding the fully-qualified class name of 
                     the aforementioned implementation
                     
                  </li>
               </ul>
            </div>
            <p>
               
               the underlying multi-threading support can be adjusted to instantly take into account 
               the most elaborated processor architectures or scheduling requirements at a customer's 
               site.
               
            </p>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
               <h3 class="title">Important</h3>
               <p>
                  The fully-qualified class name contained in the service declaration file and in 
                  the name of the service declaration file itself need to match the classes' names 
                  in the Jar file also after the obfuscation process. 
                  
                  To this end, an additional &lt;adjust&gt; element needs to be used in the yGuard Ant 
                  script to obfuscate your yFiles for Java-powered application. 
                  The additional &lt;adjust&gt; element is presented in <a href="yGuard_obfuscation.html#ex_ant" title="Example&nbsp;A.2.&nbsp;Using the yGuard Ant task">Example&nbsp;A.2, &#8220;Using the yGuard Ant task&#8221;</a>.
                  
               </p>
               <p>
                  Similar adjustments to the fully-qualified class names need to be applied to any 
                  separate Jar files that contain custom service declarations for the service defined 
                  by the TaskExecutorFactory class.
                  
               </p>
            </div>
            <p>
               The following layout algorithms of the yFiles library have built-in support for 
               multi-threaded layout calculation:
               
            </p>
            <div class="table"><a name="tab_multithreading"></a><p class="title"><b>Table&nbsp;5.3.&nbsp;Support for multi-threaded layout calculation in yFiles algorithms</b></p>
               <table summary="Support for multi-threaded layout calculation in yFiles algorithms" width="100%" border="1">
                  <colgroup>
                     <col width="16%" align="left">
                     <col width="17%" align="left">
                     <col width="67%" align="left">
                  </colgroup>
                  <thead valign="top">
                     <tr>
                        <th align="left">Layout Style</th>
                        <th align="left">Classname</th>
                        <th align="left">Note</th>
                     </tr>
                  </thead>
                  <tbody valign="top">
                     <tr>
                        <td align="left">Organic</td>
                        <td align="left"><a href="../api/y/layout/organic/SmartOrganicLayouter.html" title="Link to API documentation" target="_top">SmartOrganicLayouter<sup xmlns="http://www.w3.org/1999/xhtml" xmlns:fo="http://www.w3.org/1999/XSL/Format"><img src="figures/icon_api.gif" align="bottom" border="0"></img></sup></a></td>
                        <td align="left">
                             See the algorithm execution options of <a href="smart_organic_layouter.html#cls_SmartOrganicLayouter" title="Class SmartOrganicLayouter">class SmartOrganicLayouter</a>.
                             
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
         </div>
      </div>
      <table class="copyright" border="0" cellpadding="0" cellspacing="0" width="100%">
         <tbody>
            <tr>
               <td align="right">
                  <p class="copyright">Copyright &copy;2004-2015, yWorks GmbH. All rights reserved.</p>
               </td>
            </tr>
         </tbody>
      </table>
      <div class="navfooter">
         <div class="navline2"></div>
         <div style="display:none"><img src="figures/navline2.jpg" alt=""><img src="figures/navbg2.jpg" alt=""></div>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="layout_architecture.html">Prev</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="layout.html">Up</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="layout_advanced_features.html">Next</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">Layout Architecture&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html" target="_top">Home</a></td>
               <td width="40%" align="right" valign="top">&nbsp;Advanced Layout Concepts</td>
            </tr>
         </table>
      </div>
   </body>
</html>