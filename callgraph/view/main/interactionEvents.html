<!doctype html>
<html>
<head>
    <title>Network | Interaction events</title>

    <script type="text/javascript" src="../dist/vis.js"></script>
    <link href="../dist/vis.css" rel="stylesheet" type="text/css"/>

    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 900px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>

<p>
    Create a simple network with some nodes and edges. Some of the events are logged in the console in improve readability.
</p>

<div id="mynetwork"></div>
<pre id="eventSpan"></pre>
<script type="text/javascript" src="data.json"></script>
<script type="text/javascript">
    var json  =  eval(data);
    console.log(json);

    // create an array with nodes
    var nodes = new vis.DataSet([
        {id: 1, label: 'Node 1', title: 'I have a popup!'},
        {id: 2, label: 'Node 2', title: 'I have a popup!'},
        {id: 3, label: 'Node 3', title: 'I have a popup!'},
        {id: 4, label: 'Node 4', title: 'I have a popup!'},
        {id: 5, label: 'Node 5', title: 'I have a popup!'}
    ]);

    // create an array with edges
    var edges = new vis.DataSet([
        {from: 1, to: 3, arrows:'to'},
        {from: 1, to: 2, arrows:'to'},
        {from: 2, to: 4, arrows:'to'},
        {from: 2, to: 5, arrows:'to'}
    ]);

    nodes = json.nodes;
    edges = json.edges

    console.log(edges)

    // create a network
    var container = document.getElementById('mynetwork');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {interaction:{hover:true}};
    var network = new vis.Network(container, data, options);

 /*   network.on("click", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>Click event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("doubleClick", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>doubleClick event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("oncontext", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>oncontext (right click) event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("dragStart", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>dragStart event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("dragging", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>dragging event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("dragEnd", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>dragEnd event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("zoom", function (params) {
        document.getElementById('eventSpan').innerHTML = '<h2>zoom event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("showPopup", function (params) {
        document.getElementById('eventSpan').innerHTML = '<h2>showPopup event: </h2>' + JSON.stringify(params, null, 4);
    });
    network.on("hidePopup", function () {
        console.log('hidePopup Event');
    });
    network.on("select", function (params) {
        console.log('select Event:', params);
    });
    network.on("selectNode", function (params) {
        console.log('selectNode Event:', params);
    });
    network.on("selectEdge", function (params) {
        console.log('selectEdge Event:', params);
    });
    network.on("deselectNode", function (params) {
        console.log('deselectNode Event:', params);
    });
    network.on("deselectEdge", function (params) {
        console.log('deselectEdge Event:', params);
    });
    network.on("hoverNode", function (params) {
        console.log('hoverNode Event:', params);
    });
    network.on("hoverEdge", function (params) {
        console.log('hoverEdge Event:', params);
    });
    network.on("blurNode", function (params) {
        console.log('blurNode Event:', params);
    });
    network.on("blurEdge", function (params) {
        console.log('blurEdge Event:', params);
    });*/

    network.on("selectNode", function (params) {
        console.log('selectNode Event:', params);
        //var connectedEdges = network.getConnectedEdges(params.nodes[0])

        function Selections() {
            this.nodes = [];
            this.edge = [];
        }; 

        var  sel = new Selections();
        console.log("before recursivePaint");
        recursivePaint(params.nodes[0], sel);

        
        network.setSelection(selections, {highlightEdges: true});
        console.log("after paint");
        //network.selectNodes(startNodesArray);

       /* 
        console.log(connectedNodes);
        network.selectNodes(params.nodes);
        if(connectedNodes != null || connectedNodes.length > 0){
            network.selectNodes(connectedNodes, false);
        } */

    });
    //TODO fix this fucking recursion!!!¬¬
    function recursivePaint(nodeStart, selections){
        if(contains(nodeStart,selections.nodes)){
            console.log(nodeStart + " is in" + selections.nodes)
            return;
        }

        //Add current Node to selection
        selections.nodes.push(nodeStart);

        //get all edges for this node
        var connectedEdges = network.getConnectedEdges(nodeStart);
        for(i=0; i < connectedEdges.length; i++){

            //get toNode of current edge
            var toNode = network.getConnectedNodes(connectedEdges[i])[1];

            //if toNode is different of currentNode, add egde and call to next Node;
             if(toNode != nodeStart && !contains(toNode, selections.nodes)){
                console.log("Going to " + toNode);
                selections.edges = connectedEdges[i];
                recursivePaint(toNode,selections);
             }

        }

    }

    function contains(key, array){

        for(i=0; i < array.length; i++){
            if(key == array[i]){

                return true;
            }
        }
        return false;
    }


</script>

<script src="../../googleAnalytics.js"></script>
</body>
</html>
