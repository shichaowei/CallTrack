<!doctype html>
<html>
<head>
    <title>Network | Interaction events</title>

    <script type="text/javascript" src="../dist/vis.js"></script>
    <link href="../dist/vis.css" rel="stylesheet" type="text/css"/>

    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 900px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>

<p>
    Create a simple network with some nodes and edges. Some of the events are logged in the console in improve readability.
</p>

<div id="mynetwork"></div>
<pre id="eventSpan"></pre>
<script type="text/javascript" src="data.json"></script>
<script type="text/javascript">

    function Selections() {
            this.nodes = [];
            this.edges = [];
        }; 

    var  selectionsObjects = {nodes: [], edges: []}

    var json  =  eval(data);
    console.log(json);

    // create an array with nodes
    var nodes = new vis.DataSet([
        {id: 1, label: 'Node 1', title: 'I have a popup!'},
        {id: 2, label: 'Node 2', title: 'I have a popup!'},
        {id: 3, label: 'Node 3', title: 'I have a popup!'},
        {id: 4, label: 'Node 4', title: 'I have a popup!'},
        {id: 5, label: 'Node 5', title: 'I have a popup!'}
    ]);

    // create an array with edges
    var edges = new vis.DataSet([
        {from: 1, to: 3, arrows:'to'},
        {from: 1, to: 2, arrows:'to'},
        {from: 2, to: 4, arrows:'to'},
        {from: 2, to: 5, arrows:'to'}
    ]);

    nodes = json.nodes;
    edges = json.edges

    console.log(edges)

    // create a network
    var container = document.getElementById('mynetwork');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {interaction:{hover:true}};
    var network = new vis.Network(container, data, options);

 /*   network.on("click", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>Click event:</h2>' + JSON.stringify(params, null, 4);
    });

    


    network.on("doubleClick", function (params) {
        if(params.nodes.length == 0)
            return;


        function Selections() {
            this.nodes = [];
            this.edges = [];
        }; 

        var  sel = new Selections();
        console.log("before recursivePaint");
        recursivePaint(params.nodes[0], sel);

        
        network.setSelection(selections, {highlightEdges: true});
        console.log("after paint");

        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>doubleClick event:</h2>' + JSON.stringify(params, null, 4);
    });

   
    network.on("oncontext", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>oncontext (right click) event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("dragStart", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>dragStart event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("dragging", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>dragging event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("dragEnd", function (params) {
        params.event = "[original event]";
        document.getElementById('eventSpan').innerHTML = '<h2>dragEnd event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("zoom", function (params) {
        document.getElementById('eventSpan').innerHTML = '<h2>zoom event:</h2>' + JSON.stringify(params, null, 4);
    });
    network.on("showPopup", function (params) {
        document.getElementById('eventSpan').innerHTML = '<h2>showPopup event: </h2>' + JSON.stringify(params, null, 4);
    });
    network.on("hidePopup", function () {
        console.log('hidePopup Event');
    });
    network.on("select", function (params) {
        console.log('select Event:', params);
    });
    network.on("selectNode", function (params) {
        console.log('selectNode Event:', params);
    });
    network.on("selectEdge", function (params) {
        console.log('selectEdge Event:', params);
    });
    network.on("deselectNode", function (params) {
        console.log('deselectNode Event:', params);
    });
    network.on("deselectEdge", function (params) {
        console.log('deselectEdge Event:', params);
    });
    network.on("hoverNode", function (params) {
        console.log('hoverNode Event:', params);
    });
    network.on("hoverEdge", function (params) {
        console.log('hoverEdge Event:', params);
    });
    network.on("blurNode", function (params) {
        console.log('blurNode Event:', params);
    });
    network.on("blurEdge", function (params) {
        console.log('blurEdge Event:', params);
    });*/

    /*
    network.on("selectNode", function (params) {
        console.log('selectNode Event:', params);
        //var connectedEdges = network.getConnectedEdges(params.nodes[0])

        
        console.log("before recursivePaint");
        recursivePaint(params.nodes[0], sel);

       // console.log("Connected Nodes: " +  network.getConnectedNodes(params.nodes[0]));
        c//onsole.log("Connected Edges: " + network.getConnectedEdges(params.nodes[0]));
        //network.setSelection(selections, {highlightEdges: false});
        console.log("after paint");
        //network.selectNodes(startNodesArray);


       /* 
        console.log(connectedNodes);
        network.selectNodes(params.nodes);
        if(connectedNodes != null || connectedNodes.length > 0){
            network.selectNodes(connectedNodes, false);
        } 

    });*/
    var paintedNodes = [];
    var paintedEdges = [];
    network.on("selectNode", function (params) {
        //selectionsObjects
        var rootNode = params.nodes[0];
        var edgesToSelect = [];
        var nodesToSelect = [];
        if(rootNode != null){
            paint(rootNode);
        }

    });


    function paint(rootNode){
        if(contains(rootNode, paintedNodes)){
            return;
        }
        var edgesToSelect = [];
        var nodesToSelect = [];
         if(rootNode != null){
            console.log("painting " + rootNode + " ...");
            paintedNodes.push(rootNode);
            
           // var nodesToSelect = network.getConnectedNodes(rootNode);
            var edges = network.getConnectedEdges(rootNode);

            for(i = 0; i < edges.length; i++){
                if(edges[i][1] != rootNode){
                    edgesToSelect.push(edges[i]);
                }
            }

            //alert(nodesToSelect);
            //network.selectNodes(nodesToSelect,true);
            //network.selectEdges(edgesToSelect);

            for(i = 0; i < nodesToSelect.length; i++){
                paint(nodesToSelect[i]);
              
            }

        }

    }


    //TODO fix this fucking recursion!!!¬¬
    function recursivePaint(nodeStart, selections, nodes){
        console.log(selections);
        if(contains(nodeStart,selections.nodes)){
            console.log(nodeStart + " is in" + selections.nodes);
            return;
        }else{
             console.log(nodeStart + " is not in" + selections.nodes)
        }

        //Add current Node to selection
        selections.nodes.push(nodeStart);

        //get all edges for this node
        var connectedEdges = network.getConnectedEdges(nodeStart);
        console.log(connectedEdges.length);
        for(i=0; i < connectedEdges.length; i++){

            console.log("length: " + connectedEdges.length + "i: " + i);
            
            //get toNode of current edge
            var toNode = network.getConnectedNodes(connectedEdges[i])[1];

            //if toNode is different of currentNode, add egde and call to next Node;

             if(toNode != nodeStart && !contains(nodeStart, selections.nodes)){
                console.log("Going to " + toNode);
                selections.edges.push(connectedEdges[i]);
                console.log("calling recursion")
                return recursivePaint(toNode,selections);
             }

             //console.log(selections);

        }

    }

    function contains(key, array){
        var count = 1;
        console.log(key);
        console.log(array);
        for(i=0; i < array.length; i++){
            console.log("tested " + count + " time(s)");
            if(key == array[i]){

                return true;
            }
            count++;
        }
        console.log("End of for when testing " + key + " value");
        return false;
    }


</script>
</body>
</html>
